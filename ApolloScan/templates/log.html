{% extends "scan_page.html" %}

{%block loader_header %}

<!-- DataTables CSS -->
<link href="../../static/bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.css" rel="stylesheet">
<script src="../../static/bower_components/jquery/dist/jquery.min.js"></script>
<script src="../../static/bower_components/datatables/media/js/jquery.dataTables.min.js"></script>
<script src="../../static/bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.min.js"></script>
{% endblock %}

{%block loader_content %}
<div class="row">
  <div class="col-lg-12">
      <h1 class="page-header">{{title}}</h1>
  </div>
  <!-- /.col-lg-12 -->
</div>
<div class="row">
  <div class="col-lg-12">
      <div class="panel panel-default">
          <div class="panel-heading">
              DataTables Advanced Tables
          </div>
          <!-- /.panel-heading -->
          <div class="panel-body">
              <div class="dataTables_wrapper form-inline dt-bootstrap no-footer">
                <div class="dataTables_length" id="dataTables-example_length">
                <!-- <button id="redraw" style="width: 50px;height: 25px">刷新</button> -->
                <table class="table table-striped table-bordered table-hover dataTable no-footer" id="dataTables-example" role="grid">
                 <thead>
                  <tr role="row">
                      <th style="width: 50px;">Number</th>
                      <th style="width: 110px;">Date</th>
                      <th style="width: 110px;">Time</th>
                      <th style="width: 110px;">File</th>
                      <th style="width: 110px;">Platform</th>
                  </tr>
                 </thead>
                 <tbody></tbody>
                 <!-- tbody是必须的 -->
                </table>
              </div>
            </div>
          </div>
          <!-- /.panel-body -->
      </div>
      <!-- /.panel -->
  </div>
  <!-- /.col-lg-12 -->
</div>


<div class="row">
  <div class="col-lg-12">
      <div class="panel panel-default">
          <div class="panel-body">
            <iframe id="frame_content" width="100%" height="400px"></iframe>
          </div>
          <!-- /.panel-body -->
      </div>
      <!-- /.panel -->
  </div>
  <!-- /.col-lg-12 -->
</div>
{% endblock %}

{%block loader_javascript %}

<script type="text/javascript">
/*Javascript代码片段*/
var t = $('#dataTables-example').DataTable({
    ajax: {
        //指定数据源
        url: "../../scan/api/",
        data: {
            'action': 'loglist',
        },
    },
    //每页显示三条数据
    pageLength: 3,
    columns: [{
        "data": null //此列不绑定数据源，用来显示序号
    },
    {
        "data": "date"
    },
    {
        "data": "time"
    },
    {
        "data": "file"
    },
    {
        "data": "platform"
    }],
    "lengthMenu": [[3, 6, 20, 50, -1], [3, 6, 20, 50, "All"]],
    "columnDefs": [{
         //"visible": false,
         //"targets": 0
    },
    {
        "render": function(data, type, row, meta) {
            //渲染 把数据源中的标题和url组成超链接
            return '<a href="javascript:showlog(\''+row.file+'\');"' + data + '" target="_blank">查看</a>';
        },
        //指定是第三列
        "targets": 3
    }]

});

//前台添加序号
t.on('order.dt search.dt',
function() {
    t.column(0, {
        "search": 'applied',
        "order": 'applied'
    }).nodes().each(function(cell, i) {
        cell.innerHTML = i + 1;
    });
}).draw();

// //更换数据源（相同格式，但是数据内容不同）
// $("#redraw").click(function() {
//     var url = table.api().ajax().url("../../scan/api/?action=loglist");
//     url.load();
// });

//显示内容
function showlog(file) {
  $.ajax( {
    url:'../../scan/api/?action=',// 跳转到 action
    data: {
        'action': 'getlog',
        'file': file,
    },
    async : false,
    success:function(data) {
      document.getElementById('frame_content').contentWindow.document.open()
      document.getElementById('frame_content').contentWindow.document.write(JSON.stringify(data));
      document.getElementById('frame_content').contentWindow.document.close()
    },
    error : function() {
      document.getElementById('frame_content').contentWindow.document.open()
      document.getElementById('frame_content').contentWindow.document.write('发生错误！');
      document.getElementById('frame_content').contentWindow.document.close()
    }
    });
};
</script>
{% endblock %}
